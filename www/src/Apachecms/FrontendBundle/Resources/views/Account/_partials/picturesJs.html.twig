<script src="{{ asset('bundles/apachecmsbackend/fileUpload/js/jquery.ui.widget.js') }}"></script>
<script src="{{ asset('bundles/apachecmsbackend/fileUpload/js/jquery.iframe-transport.js') }}"></script>
<script src="{{ asset('bundles/apachecmsbackend/fileUpload/js/jquery.fileupload.js') }}"></script>
<script type="text/javascript">
    var counterImage='{{ app.user.files | length }}';
    function deleteFile(id){
        var file=id;
        console.log(file);
        swal({   
            title: "{{ messages.delete.title }}",   
            text: "{{ messages.delete.text }}",   
            type: "{{ messages.delete.type }}",   
            showCancelButton: true,   
            confirmButtonColor: "#DD6B55",   
            confirmButtonText: "{{ messages.delete.confirmButtonText }}",   
            cancelButtonText: "{{ messages.delete.confirmCancelText }}",   
            closeOnConfirm: true 
        }, function(){
            var url="{{ path('apachecms_api_files_remove',{ file: 'ENTITY_ID' })}}";
            $.post(url.replace('ENTITY_ID',file), {}, function (result) {
                if (result.response == true) {
                    $('#'+file).remove();
                    counterImage--;
                    $('#counter-image').html(counterImage);
                    $.toast({
                        heading: '{{ messages.result.success.title }}',
                        text: '{{ messages.delete.success }}',
                        position: 'top-right',
                        icon: '{{ messages.result.success.icon }}',
                        hideAfter: 1000, 
                        stack: 6
                    });
                }else{
                    $.toast({
                        heading: '{{ messages.result.error.title }}',
                        text: '{{ messages.result.error.text }}',
                        position: 'top-right',
                        icon: '{{ messages.result.error.icon }}',
                        hideAfter: 1000, 
                        stack: 6
                    });
                }
            });
        });
    }
    $(function () {
    'use strict';
    $('#fileupload').fileupload({
        url: '{{ path('apachecms_api_files_upload',{ industry: app.request.get('id') }) }}',
        dataType: 'json',
        done: function (e, data) {
            if(data.result.response==true){
                $.each(data.result.data, function (index, file) {
                    $(`<div class="col-sm-3" onclick="sendBackground(this)" data-scroll="page-top" data-src='{{ app.request.scheme }}://{{ app.request.httpHost }}{{ asset('uploads/or/')}}${file.name}' style="margin-bottom:15px; margin-top:15px; cursor:pointer;" id="${file.id}">
                    <a href="javascript:deleteFile('${file.id}')" data-id="${file.id}" class="fa-stack fa-sm text-danger" style="position: absolute;right: -10px;top: -20px;z-index: 5;">
                        <i class="fa fa-circle-thin fa-stack-2x"></i>
                        <i class="fa fa-remove fa-stack-1x"></i>
                    </a>
                    <div class="cover img-thumbnail" style="height:100px; background-image:url('{{ asset('uploads/sm/') }}${file.name}')"></div>
                </div>`).appendTo('#files');
                    counterImage++;
                    $('#counter-image').html(counterImage);
                });
            }else{
                $.toast({
                        heading: '{{ messages.result.error.title }}',
                        text: data.result.error.message,
                        position: 'top-right',
                        icon: '{{ messages.result.error.icon }}',
                        hideAfter: 1000, 
                        stack: 6
                    });
            }
        },
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css(
                'width',
                progress + '%'
            );
            if(data.loaded==data.total){
                $('#progress .progress-bar').css(
                    'width','0%'
                );
            }
        }
    }).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled');
});
</script>

