{% extends "ApachecmsBackendBundle::layout.html.twig" %}
{% block body %}
{{ parent()}}
<h3 class="card-title">
    {% if app.request.attributes.get('_route_params')._breadcrumbs is defined %}
       Landings publicadas pendientes de aprobación
    {% endif %}
    {# <button type="button" class="btn btn-success btn-rounded pull-right" onclick="location.href='{{ path(pathBase~'_add')}}'"><i class="fa fa-plus"></i> Agregar</button> #}
</h3>

<div class="table-responsive">
    <table id="{{ pathBase }}_dataTable" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
    </table>
</div>
{% endblock body %}
{% block javascripts %} 
{{ parent() }}
{% include 'ApachecmsBackendBundle:_partials:dataTableScripts.html.twig' with { pathBase:pathBase, url: path('apachecms_backend_homepage_pending') } %}
<script type="text/javascript">
    $(function () {
        $('#{{ pathBase }}_dataTable').DataTable({
            order: [[ 5, 'desc' ]],
            columns: [
                { title:"Título",data: "title" },
                { title:"Empresa",data: "b_name" },
                { title:"Cliente",data: "c_name" },
                { 
                    data: 'status', 
                    title: '{{ 'status' | trans }}',
                    render: function (data, type, row) 
                    {
                        switch (data){
                            case 'draft':
                                return '<span class="badge badge-pill badge-warning">{{ 'draft' | trans }} ({{ 'step' | trans }} '+row.current_step+')</span>';
                                break;
                            case 'published':
                                return '<span class="badge badge-pill badge-success">{{ 'published' | trans }}</span>';
                                break;
                            case 'ready':
                                return '<span class="badge badge-pill badge-primary">{{ 'ready' | trans }}</span>';
                                break;
                        }
                    }
                },
                { 
                    data: 'isReview', 
                    title: '{{ 'review' | trans }}',
                    render: function (data, type, row) 
                    {
                        switch (data){
                            case true:
                                return '<span class="badge badge-pill badge-success">{{ 'yes' | trans }}</span>';
                                break;
                            case false:
                                return '<span class="badge badge-pill badge-danger">{{ 'no' | trans }}</span>';
                                break;
                            default:
                                return '<span class="badge badge-pill badge-warning">{{ 'pending' | trans }}</span>';
                                break;
                        }
                    }
                },
                { 
                 title:"Creado",
                    data: "createdAt",
                    "sType": "date-euro",
                    render: function (data, type, JsonResultRow, meta) {
                        var d = new Date(data.timestamp * 1000);
                        return `${(d.getDate()<10?'0':'') + d.getDate()}/${(d.getMonth()+1)}/${d.getFullYear()} ${(d.getHours()<10?'0':'') + d.getHours()}:${(d.getMinutes()<10?'0':'') + d.getMinutes()}`;
                    }
                },
                {
                    data: null,
                    orderable: false,
                    className: "text-center",
                    defaultContent: `
                    <button type="button" title="Ver" class="btn-view btn btn-outline-info btn-circle"><i class="fa fa-eye"></i></button>`
                }
            ]
        });
    });
    {# $('#{{ pathBase }}_dataTable').on('click', 'button.btn-preview', function () {
        var data = $('#{{ pathBase }}_dataTable').DataTable().row( $(this).parents('tr') ).data();
        var url="{{ path('apachecms_frontend_land',{ slug: 'SLUG' })}}";
        window.open(url.replace('SLUG',data.slug));
    }); #}
    $('#{{ pathBase }}_dataTable').on('click', 'button.btn-view', function () {
        var data = $('#{{ pathBase }}_dataTable').DataTable().row( $(this).parents('tr') ).data();
        var url="{{ path('apachecms_backend_landings_view',{ id: 'ENTITY_ID' })}}";
        location.href=url.replace('ENTITY_ID',data.id);
    });
</script>
<style>
table.dataTable th:first-child {
 min-width:110px!important;
  max-width: 130px!important;
  word-break: break-all;
  white-space: pre-line;
}
table.dataTable th:nth-child(1) {
 min-width:110px!important;
  max-width: 130px!important;
  word-break: break-all;
  white-space: pre-line;
}

table.dataTable td:nth-child(2) {
  min-width:120px!important;
  max-width: 150px!important;
  word-break: break-all;
  white-space: pre-line;
}
table.dataTable td:nth-child(3) {
  min-width:100px!important;
  max-width: 150px!important;
  word-break: break-all;
  white-space: pre-line;
}
</style>
{% endblock %}